{% extends "base.html" %}

{% block title %}Sign In - Norwegian Flashcards{% endblock %}

{% block content %}
  <h1>Sign In or Create an Account</h1>
  <!-- Container where the FirebaseUI widget will be rendered -->
  <div id="firebaseui-auth-container"></div>
  <!-- A place to display error messages -->
  <div id="firebaseui-auth-error" style="color:red;"></div>

  <!-- FirebaseUI config script -->
  <script type="module">
    // Import Firebase modules (using Firebase v11 modules)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-app.js";
    import { getAuth } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-auth.js";

    
    // Initialize Firebase (you can also keep this in your base.html if you prefer)
    const firebaseConfig = {
      apiKey: "AIzaSyBk6qvyH7O-4txr2in2uSPpXHYjCZdXxQQ", 
      authDomain: "norwegianteachin.firebaseapp.com",
      projectId: "norwegianteachin",
      storageBucket: "norwegianteachin.firebasestorage.app",
      messagingSenderId: "398506765329",
      appId: "1:398506765329:web:c6d9f41df5682bf18e95b0", 
      measurementId: "G-DNN3J7P7KY"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // FirebaseUI configuration.
    const uiConfig = {
      signInFlow: 'popup',  // Use popup for sign in so that it doesn't redirect.
      signInOptions: [
        // List of providers supported.
        firebaseui.auth.AuthUI.getInstance() ? firebaseui.auth.AuthUI.getInstance().getConfig().signInOptions : null,
        {
          provider: 'password', // Email/password sign in
          requireDisplayName: true
        },
        {
          provider: 'google.com' // Google sign in
        }
        // You can add additional providers here.
      ].filter(Boolean), // filter out any null values
      // Callbacks:
      callbacks: {
        signInSuccessWithAuthResult: function(authResult, redirectUrl) {
          // User successfully signed in.
          // Redirect to the home page.
          window.location.assign("/");
          return false; // Avoid redirects after sign-in.
        },
        uiShown: function() {
          // Hide the loader if any.
        }
      },
      // Optional: you can specify URLs for terms of service and privacy policy.
      tosUrl: "/terms-of-service",
      privacyPolicyUrl: "/privacy-policy"
    };

    // Initialize the FirebaseUI Widget using Firebase.
    const ui = new firebaseui.auth.AuthUI(auth);
    // The start method will wait until the DOM is loaded.
    ui.start('#firebaseui-auth-container', uiConfig);
  </script>

  <!-- Include the FirebaseUI CSS (you can also link to it in your base.html) -->
  <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.0.2/firebase-ui-auth.css" />
{% endblock %}
